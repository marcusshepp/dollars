{% extends "receipt/base.html" %}
{% block title %}form{% endblock %}
{% block content %}
<h3 class="page-header">Purchasable Items</h3>
{{ form.errors }}
<div class="row">
  <div class="col-md-6">
    <h4 id="item_form_header">Add New Item</h4>
    <form class="formmy item_form" action="{% url 'items' %}" method="POST" enctype="multipart/form-data">{% csrf_token %}
      <p><label for="name">Name: </label><input type="text" name="name" max_length="250"/></p>
      <p><label for="company_came_from">Company: </label><input type="text" name="company_came_from" max_length="50"></p>
      <p><label for="price">Price: </label><input type="number" name="price" step="0.01"></p>
      <input type="button" value="Submit" class="btn btn-default" onclick="send_new_item(this.form)">
    </form>
  </div>
  <div class="col-md-6">
      <h4>Available Items</h4>
      <div class="items">
        {% for i in items %}
        <div class="item"><div class="pull-left">{{i.name}} {{i.company_came_from}} {{i.price}}</div><span class="badge pull-right">{{ i.times_purchased }}</span></div><br />
        {% endfor %}
      </div>
  </div>  
</div>
<script type="text/javascript">
  var collect_items = setInterval(function(){
    $.ajax({
        type: "GET",
        url: "{% url 'api_items' %}",
        success: function(data){
          var item_markup = "";
          for (var i = 0; i < data.length; i++){
            var name = data.names[i]
            var company = data.companies[i]
            var price = data.prices[i]
            var times_purchased = data.times_purchased[i]
            item_markup += "<div class='item'><div class='pull-left'>" + name + " " + company + " " + price + "</div><span class='badge pull-right'>" + times_purchased + "</span></div><br />"
          }
          $(".items").html(item_markup);
        }
    });
  }, 5000)
  function send_new_item(form){
    var url = form.action;
    var form_data = $(form).serializeArray();
    var name = form_data[1].value;
    $.post(url, form_data);
    $("#item_form_header").html("<p class='text-success'>Successfully Added: " + name +  "</p>");
    document.getElementsByClassName('item_form')[0].reset();
  }
</script>
{% endblock %}
